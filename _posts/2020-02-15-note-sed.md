---
layout: post
title: sed命令学习笔记
date: 2020-02-15
categories: note linux
tags: sed
cover: '../../../assets/img/20200215.jpg'
---

## sed的基本使用
###  sed----流处理编辑器
```
文本或者管道
V
读入一行到模式空间 <--
V                                          ^
sed命令处理-------------|
V
输出到屏幕
```
+ Tips: 模式空间，即零时的缓冲区

### sed文本处理
正则选定文本 -> sed进行处理

### sed格式
#### 命令行格式
`$ sed [options] 'command'  file(s)`
+ 主要参数(options) :   -e;  -n
+ 命令(command):  行定位(正则)+sed命令(操作)
#### 脚本格式
`$ sed -f scriptfile file(s)`

### sed操作命令
#### 基本操作命令1
+ p (打印行)
  + 例:  sed 'p'   文件名
+ -n (只打印和结果相关的行)
  +  例:  sed -n 'p'   文件名

#### sed行定位
+ 行号定位一行：sed   -n  '10p'  文件名
+ 正则定位一行：sed   -n  '/要搜索的字符或字符串/p'   文件名
+ 行号范围定位：sed   -n  '10,20p'   文件名
+ 正则定位范围：sed   -n   '/开始行的关键字/,/结束行的关键字/p' 文件名
+ 取反：sed   -n '10!p'  文件名（除了第十行）
+ 范围取反：sed -n '10,20!p'  文件名（除了第十到二十行）
+ 定位间隔几行：sed -n  '1~2p' 文件名   （输出1,3,5,7,9……）


#### 基本操作命令2
+ a（新增行）
  + 例1：sed '5a ================' 文件名   （在第五行下面增加一行分隔符）
  + 例2：sed '1,5a ===============' 文件名   （在第一行到第五行下面都增加分隔符）
+ i （插入行）
  + 例1：sed '5i ================' 文件名   （在第五行上面增加一行分隔符）
  + 例2：sed '1,5i ===============' 文件名   （在第一行到第五行上面都增加分隔符）
+ c（替代行）
  + 例1：sed '5c ================' 文件名   （在第五行替换成分隔符）
  + 例2：sed '1,5c ===============' 文件名   （在第一行到第五行整体替换成分隔符）
+ d（删除行）
  + 例1：sed '5d' 文件名   （删除第五行）



#### 基本操作命令3
+ s（替换）：分隔符/,#等   //默认只替换一个
  + 例：sed 's/false/true/'  文件名  //把文件中的第一个false替换为true
+ g（全局）：替换标志
  + 例：sed 's/false/true/g'  文件名  //把文件中的false全部替换为true

#### 案例
+ 在文档末尾去新增几行
```
sed  '$a port     \nhshkahdajhfkjh'   文件名  //\n换行`
sed  '$a \    port     \n     hshkahdajhfkjh'   文件名  //\也可以用来转义空格
```
+ 删除文本的空行
```
sed  '/^$/d'   文件名
```
+ 匹配文件中的error
```
sed -n '/Error/p'  文件名
```

#### 高级操作命令
+ {}：多个sed命令，用;分开
  1. 例：sed '{20,30d;s/false/true/g}' 文件名  //先删除20到30行，再替换掉所有false为true
+ n：读取下一个输入行(用下一个命令处理)//跳行操作
  1. 例：sed  -n  '{n;p}' 文件名  //隔一行输出一次2,4,6…… 偶数行的输出
  2. 例：sed  -n  '{p;n}' 文件名  //隔一行输出一次1,3,5…… 奇数行的输出
  3. 例：sed  -n  '{n;n;p}' 文件名   //不要没事为难自己去用上面介绍的~来跳行
  4. 例：sed  -n  '{n;p;n}' 文件名   //不要没事为难自己去用上面介绍的~来跳行
+ &：替换固定字符串
  1. 例：sed  's/W/&123/'   文件名  //用&代替了W
+ \( \)：替换某种（部分）字符串（\1,\2
  1. 例：sed 's/w1\(w2\)\(w3\)/\1  \2/g'   文件名    //表示把w1w2w3这个字符串替换成w2    w3   
+ r：复制指定文件插入匹配行
  1. sed '1r   被读文件名'   匹配的文件名   //读入被读文件插入匹配文件的第一行（只会输出出来文件内容不变）
+ w：复制匹配行拷贝到指定文件里
  1. sed '1w  被写文件名'  匹配的文件名    //复制匹配文件的第一行写入被写文件的第一行（覆盖写入会更改文件内容）
  2. sed 'w  被写文件名'  匹配的文件名      //复制匹配文件全部写入被写文件（覆盖写入会更改文件内容）
+ q：退出sed
  1. sed  '10q'  文件名   //到第十行停止sed命令


#### 案例
1.匹配passwd中的用户并给其后加上空格
```
cat   /etc/passwd |  sed 's/^[a-z_-]\+/&       /g'  
```
2.将passwd中的用户名首字母转换为大写
（会用到元字符\u \l  \U  \L）
+ \u：首字母小写变大写
+ \l：  首字母大写变小写
+ \U： 一串有长度的字符小写变大写
+ \L：  一串有长度的字符大写变小写
```
cat   /etc/passwd |  sed 's/^[a-z_-]\+/\u&/g'  
```
3.将文件夹下.txt文件名转换成大写
```
ls *.txt  |  sed 's/^\w\+/\U&/g'   //你品你细品    \w是 匹配任何字类字符，包括下划线（[A-Za-z0-9_]） \+是重复表示其可以出现不止一次
```
4.数据筛选 "获取passwd中的USER、UID和GID"
```
cat /etc/passwd  |  sed 's/\(^[a-z_-]\+\):x:\([0-9]\+\):\([0-9]\+\):.*/USER:\1    UID:\2     GID:\3/g'    //这个也得细品  
```
5. 筛选ip
```
ifconfig  网卡名  |sed -n '/inet /p'|sed 's/ine.*r:\([0-9.]\+\) .*/\1/g'
```

